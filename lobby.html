<html>

<head onload='setUp()'>
    <title>ASF Virtual App</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="css/main.css" />
    
</head>

<body class="is-preload">
    <!--Heading-->
    <header id="header">
        <h2>Please provide this code to your team: </h2>
        <button id='codeButton' onclick='generateCode()'>Generate Code</button>
        <div>
            <p  id='name'>Name: </p>
            <p  id='type'>Type: </p>
            <p id='roomCodeDisplay'>Code: </p>

        </div>
    </header>
    <main>
        <div>
            <ul id="userList">

            </ul>
        </div>
    </main>
    <!-- Footer -->
    <footer id="footer">
        <ul class="copyright">
            <li>&copy; CACI.</li>
            <li>Credits:HTML5 UP</a></li>
        </ul>
    </footer>
</body>

</html>
<script src="/socket.io/socket.io.js"></script>
<script>//create a new socket room on each page load
    //var code,name,type;
    var code = localStorage.getItem('code');
    const type = localStorage.getItem('type');
    const name = localStorage.getItem('name');
    var socket = io();

    (function setUp(){
        console.log("Setting name type and code");
        document.getElementById('name').innerHTML += name;
        document.getElementById('type').innerHTML += type;
        if(type === "Scrum Master"){
            document.getElementById('codeButton').style.visibility = 'visible' ;
            generateCode();
        } else {
            document.getElementById('codeButton').style.visibility = 'hidden';
            document.getElementById('roomCodeDisplay').innerHTML += code;
            socket.emit("joinRoom", {code: code, type: type, name: name} );
        }

    })();
    
    socket.on('joinRoom', (data) => {
        console.log('joinRoom was recieved' + data);
        socket.emit("joinRoom", {code: data, type:type, name: name});
        console.log('got to line 66');
    });
    socket.on("displayName", (data) => {
        console.log('display name started: ' + data);
        for(var i =0; i< data.length; i++){
        var node = document.createElement("LI");
        var nodeElem = document.createTextNode(data[i]);
        console.log(data);
        node.appendChild(nodeElem);
        document.getElementById('userList').appendChild(node);
        }
    });



    function generateCode() {//dont need html requests anymore hopefull
        const oldCode = code;
        code = "";
        for (var i = 0; i < 4; i++) {
            code += parseInt(Math.random() * 10);
        }
        document.getElementById('roomCodeDisplay').innerHTML = 'Code: ' + code;
        code = code.toString();
        localStorage.setItem('code',code);

        console.log(code);
        const data = { //data for deleting the old room and creating a new one
            oldcode: oldCode, 
            code: code, 
            type:type, 
            name: name
        };
        socket.emit("addRoom", data); 
        console.log('end of generateCode');
    }
</script>

<style>
    #header {
        top: 20%;
        position: absolute;
    }

</style>